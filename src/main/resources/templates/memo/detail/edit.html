<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
<script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.polyfills.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="http://unpkg.com/easymde/dist/easymde.min.css">
<script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>

<head>
  <meta charset="UTF-8">
  <title>メモ編集</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
  <div>
    <header th:replace="~{fragments/common-header :: common-header}"></header>
  </div>

  <div class="sidebar" th:replace="~{fragments/common-sidebar :: common-sidebar}"></div>

  <div class="memo-detail-container">
    <div class="back-indicator">
      <a th:href="@{/memo/detail/{id}(id=${actionDto.id})}">
        <img th:src="@{/image/back-icon.svg}" alt="戻る">
        <span>戻る</span>
      </a>
    </div>

    <form class="memo-form"
          th:action="@{/memo/detail/edit/{id}(id=${actionDto.id})}"
          th:object="${actionDto}" method="post">
      <div class="memo-form-title">メモ</div>
      <div class="input-content">
        <table class="memo-edit-table">
          <tr>
            <th scope="row" class="row-th">タイトル</th>
            <td class="blank-cell"></td>
            <td>
              <input type="text" class="input-memo-title" th:field="*{title}" required />
            </td>
          </tr>
          <tr class="blank-col"></tr>
          <tr>
            <th colspan="3" scope="col" class="col-th">内容</th>
          </tr>
          <tr>
            <td colspan="3">
              <textarea id="content" th:field="*{content}"></textarea>
              <!-- EasyMDEの設定 -->
              <script th:inline="javascript">
                /*<![CDATA[*/
                    const easyMDE = new EasyMDE({
                        element: document.getElementById("content"),
                        spellChecker: false,
                        toolbar: [
                            "undo",
                            "redo",
                            "bold",
                            "italic",
                            "strikethrough",
                            "unordered-list",
                            "ordered-list",
                            "code",
                            "quote",
                            "link",
                            "table",
                            "preview",
                            "guide"
                        ]
                    });
                /*]]>*/
              </script>
            </td>
          </tr>
          <tr class="blank-col"></tr>
          <tr>
            <th scope="row" class="row-th">タグ</th>
            <td class="blank-cell"></td>
            <td>
              <input type="text" id="tags-input" th:field="*{tags}" class="tags-input">
            </td>
          </tr>
        </table>

        <script th:inline="javascript">
          /*<![CDATA[*/
            const tagNameList = /*[[${tagNameList}]]*/ [];
            const input = document.querySelector("#tags-input");

            new Tagify(input, {
                pattern: /#/,
                whitelist: tagNameList,
                dropdown: {
                  enabled: 0,
                  classname: "tags-look",
                  maxItems: 10,
                  closeOnSelect: false
                  },
                  enforceWhitelist: false,
            });
          /*]]>*/
        </script>
      </div>
      <div class="button-area">
        <button type="submit" class="register-button">登録</button>
      </div>
    </form>
  </div>
</body>